
const calibrar = document.querySelector("#calibrar");
calibrar.style.display = 'none';
const ver_pontos = document.querySelector("#ver_pontos");
ver_pontos.style.display = 'none';
const ctrlz = document.querySelector("#ctrlz");
const textPontos = document.getElementById("textpontos");
const closepop = document.getElementById("close-popup");
var clicou_ctrlz = false;
var calibrado = false;
var pontosx = [];
var pontosy = [];
var originalWidth;
var originalHeight;
var eixos = [];
var qtdPontos = 0;
var xa, xb, ya, yb;
var last = 0;




calibrar.onclick = () =>{
    console.log();
    window.electronAPI.abreCalibrarWindow(eixos[0], eixos[1], eixos[2], eixos[3]);
    calibrado = true;
    qtdPontos = 0;
    
    document.querySelector("#tela").getContext('2d').clearRect(0, 0, tela.width, tela.height);
    calibrar.style.display = 'none';
    ver_pontos.style.display = 'block';

}
window.electronAPI.onEnviaParametros((events, a, b, c, d)=>{
    xa = a;
    xb = b;
    ya = c;
    yb = d;
});

ctrlz.onclick = ()=>{
    // depois de clicar em ctrl z tenho que clicar em ver pontos dnv pra 
    // tirar os que eu exclui
    // por causa do  texto eu n posso usar essee metodos
    // mas como são poucos pontos na hroa de calibnrar tem como eu só ficar
    // desenhando os pontos dnv
    /*
    if (!clicou_ctrlz){
        qtdPontos--;
        clicou_ctrlz = true;
    }
    contexto.clearRect(pontosx[qtdPontos]-3, 600-pontosy[qtdPontos]-3, 6, 6);
    qtdPontos--;
    */
   
}

ver_pontos.onclick = () =>{
    for (let i = 0; i < qtdPontos; i++){
        xreal = pontosx[i]*xa + xb;
        yreal = (pontosy[i]*ya + yb)
        //console.log(xreal, yreal)
        //addItemParam(`(${xreal}, ${yreal})`);
    }/*
    //window.electronAPI.verPontosWindow();
    document.getElementById('listapontos').style.display = 'block';
    inputText = document.getElementById("txt");
    items = document.querySelectorAll("#list li");
    adicionar_botao = document.querySelector('#adicionar_ponto');
    tab = [];
    index;
    refreshArray();
    for (let i = last; i < qtdPontos; i++){
        
        addLI( xreal + ", " + yreal);
    }
    last = qtdPontos;
    */
   document.querySelector(".popup").style.display = "flex";
}

const itemList = [];
const addItem = ()=>{
    const itemInput = document.getElementById("itemInput");
    const listItem = {
        id: Date.now(),
        text: itemInput.value
    };

    var cordenadas = itemInput.value.split(",");

    var xreal = parseFloat(cordenadas[0]);
    var yreal = parseFloat(cordenadas[1]);
    var xpixel = (xreal-xb)/xa;
    var ypixel = (yreal-yb)/ya;
    document.querySelector("#tela").getContext('2d').fillStyle = 'black'
    document.querySelector("#tela").getContext('2d').fillRect(xpixel-3,600-ypixel-3,6,6);
    document.querySelector("#tela").getContext('2d').fillStyle = 'red'
    document.querySelector("#tela").getContext('2d').fillRect(xpixel-2, 600-ypixel-2, 4, 4);
    pontosx[qtdPontos] = xpixel;
    pontosy[qtdPontos] = ypixel;
    qtdPontos++;



    if (listItem.text !== ""){
        itemList.push(listItem);
        renderList();
        itemInput.value = "";
    };
};
const addItemParam = (texto)=>{
    const itemInput = document.getElementById("itemInput");
    const listItem = {
        id: Date.now(),
        text: texto
    };
    if (listItem.text !== ""){
        itemList.push(listItem);
        renderList();
        itemInput.value = "";
    };
};

const deleteItem = (id) =>{
    const index = itemList.findIndex(item => item.id === id);
    if (index !== -1){
        itemList.splice(index, 1);
        renderList();
    }
}

const editItem = (id) => {
    const newText = prompt('new text');
    const index = itemList.findIndex(item => item.id === id);
    if (index !== -1 && newText !== null){
        itemList[index].text = newText;
        renderList();
    }
};

const renderList = () =>{
    const itemListContainer = document.getElementById('itemList');
    itemListContainer.innerHTML = '';
    itemList.forEach(item =>{
        const li = document.createElement('li');
        li.textContent = item.text;
        const buttonContainer = document.createElement('div');
        buttonContainer.classList.add('button-containerr');
        /*
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'delete';
        deleteBtn.addEventListener('click', () => deleteItem(item.id));
        buttonContainer.appendChild(deleteBtn);
        
        const editBtn = document.createElement("button");
        editBtn.textContent = 'edit';
        editBtn.addEventListener('click', ()=> editItem(item.id));
        buttonContainer.appendChild(editBtn);
        */
        li.appendChild(buttonContainer);
        itemListContainer.appendChild(li);
        setTimeout(()=>{
            li.classList.add("fade-in");
        }, 10);
    })
}
closepop.onclick = () => {
    console.log("LJKLJDSLASD");
    //console.log(textPontos.value);
    let entrada = textPontos.value.split("\n");
    console.log(entrada);
    document.getElementById("popup-pontos").style.display = "none";
};
//document.getElementById('addItemBtn').addEventListener('click', addItem);

